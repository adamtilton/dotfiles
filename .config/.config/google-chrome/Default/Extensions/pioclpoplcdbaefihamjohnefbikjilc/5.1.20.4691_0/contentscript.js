var logEnabled=false;Function.prototype._FunctionOverrides={};if(typeof Function.prototype.inherit=="function"){Function.prototype._FunctionOverrides.inherit=Function.prototype.inherit}if(typeof Function.prototype.inherits=="function"){Function.prototype._FunctionOverrides.inherits=Function.prototype.inherits}Function.prototype.inherit=function(c,b){if(c.constructor==Function){this.prototype=new c;this.prototype.constructor=this;this.prototype.parent=c.prototype;this.constructor.parent=c}else{this.prototype=c;this.prototype.constructor=this;this.prototype.parent=c;this.constructor.parent=c}if(b){for(var a in c.prototype.constructor){if(a!="parent"&&a!="prototype"&&c.constructor[a]!=c.prototype.constructor[a]){this.prototype.constructor[a]=c.prototype.constructor[a]}}}if(typeof this.prototype.handleInheritance=="function"){this.prototype.handleInheritance.apply(this,arguments)}if(typeof this._FunctionOverrides=="function"){this._FunctionOverrides.apply(this,arguments)}return this};Function.prototype.inherits=function(a){return(typeof this.prototype.parent!="undefined"&&this.prototype.parent.constructor==a)};function Clip(b,a){this.__defineGetter__("fullPage",this.isFullPage);this.__defineGetter__("length",this.getLength);this.__defineGetter__("stylingStrategy",this.getStylingStrategy);this.__defineSetter__("stylingStrategy",this.setStylingStrategy);this.__defineGetter__("documentBase",this.getDocumentBase);this.__defineSetter__("documentBase",this.setDocumentBase);this.initialize(b,a)}Clip.NOKEEP_NODE_ATTRIBUTES={style:null,"class":null,id:null};Clip.NODE_NAME_TRANSLATIONS={HTML:"DIV",BODY:"DIV",FORM:"DIV","*":"DIV"};Clip.SUPPORTED_NODES={A:null,ABBR:null,ACRONYM:null,ADDRESS:null,AREA:null,B:null,BASE:null,BASEFONT:null,BDO:null,BIG:null,BLOCKQUOTE:null,BR:null,BUTTON:null,CAPTION:null,CENTER:null,CITE:null,CODE:null,COL:null,COLGROUP:null,DD:null,DEL:null,DFN:null,DIR:null,DIV:null,DL:null,DT:null,EM:null,FIELDSET:null,FONT:null,FORM:null,FRAME:null,FRAMESET:null,H1:null,H2:null,H3:null,H4:null,H5:null,H6:null,HEAD:null,HR:null,HTML:null,I:null,IFRAME:null,IMG:null,INPUT:null,INS:null,KBD:null,LABEL:null,LEGEND:null,LI:null,LINK:null,MAP:null,MENU:null,META:null,NOBR:null,NOFRAMES:null,NOSCRIPT:null,OBJECT:null,OL:null,OPTGROUP:null,OPTION:null,P:null,PARAM:null,PRE:null,Q:null,QUOTE:null,S:null,SAMP:null,SCRIPT:null,SELECT:null,SMALL:null,SPAN:null,STRIKE:null,STRONG:null,STYLE:null,SUB:null,SUP:null,TABLE:null,TBODY:null,TD:null,TEXTAREA:null,TFOOT:null,TH:null,THEAD:null,TITLE:null,TR:null,TT:null,U:null,UL:null,VAR:null};Clip.REJECT_NODES={SCRIPT:null,STYLE:null,FRAME:null,FRAMESET:null,IFRAME:null,INPUT:null,SELECT:null,OPTION:null,OPTGROUP:null,TEXTAREA:null,NOSCRIPT:null,OBJECT:null,PARAM:null,CANVAS:null,HEAD:null};Clip.NOKEEP_ATTRS={id:null,"class":null,style:null};Clip.NON_ANCESTOR_NODES={OL:null,UL:null,LI:null};Clip.SELF_CLOSING_NODES={IMG:null,INPUT:null,BR:null};Clip.HTMLEncode=function(e){var b="";for(var d=0;d<e.length;d++){var c=e.charCodeAt(d);var a=e[d];if(c>127){b+="&#"+c+";"}else{if(a==">"){b+="&gt;"}else{if(a=="<"){b+="&lt;"}else{if(a=="&"){b+="&amp;"}else{b+=e[d]}}}}}return b};Clip.prototype.title=null;Clip.prototype.location=null;Clip.prototype.window=null;Clip.prototype.selectionFinder=null;Clip.prototype.deep=true;Clip.prototype._stylingStrategy=null;Clip.prototype._documentBase=null;Clip.prototype._includeFontFaceDescriptions=false;Clip.prototype.initialize=function(b,a){this.title=b.document.title;this.location=b.location;this.window=b;this.selectionFinder=new SelectionFinder(b.document);this.range=null;if(a){this.stylingStrategy=a}};Clip.prototype.isFullPage=function(){return !this.hasSelection()};Clip.prototype.hasSelection=function(){if(this.selectionFinder.hasSelection()){return true}else{this.findSelection();return this.selectionFinder.hasSelection()}};Clip.prototype.findSelection=function(){this.selectionFinder.find(this.deep)};Clip.prototype.getSelection=function(){if(this.hasSelection()){return this.selectionFinder.selection}return null};Clip.prototype.getRange=function(){if(this.hasSelection()){return this.selectionFinder.getRange()}return null};Clip.prototype.hasBody=function(){return(this.window&&this.window.document&&this.window.document.body&&this.window.document.body.tagName.toLowerCase()=="body")};Clip.prototype.hasContentToClip=function(){return(this.hasBody()||this.hasSelection())};Clip.prototype.getDocumentBase=function(){if(this._documentBase==null){var b=this.window.document.getElementsByTagName("base");if(b.length>0){for(var a=0;a<b.length;a++){this.setDocumentBase(b[a]);if(this._documentBase){break}}}if(!this._documentBase){this._documentBase=this.location.origin+this.location.pathname.replace(/[^\/]+$/,"")}}return this._documentBase};Clip.prototype.setDocumentBase=function(a){if(typeof a=="string"&&a.indexOf("http")==0){this._documentBase=a}else{this._documentBase=null}};Clip.prototype.clipBody=function(){if(!this.hasBody()){if(logEnabled){console.log("Document has no body...")}return false}if(this.stylingStrategy){this.stylingStrategy.cleanUp()}var a=0;var b=0;if(logEnabled){console.log("Getting body text: "+this);a=new Date().getTime()}this.content=this.serializeDOMNode(this.window.document.body.parentElement||this.window.document.body);if(logEnabled){b=new Date().getTime();console.log("Clipped body in "+(b-a)+" milliseconds")}if(typeof this.content!="string"){return false}return true};Clip.prototype.clipSelection=function(){if(!this.hasSelection()){if(logEnabled){console.log("No selection to clip")}return false}if(this.stylingStrategy){this.stylingStrategy.cleanUp()}var b=0;var c=0;this.range=this.getRange();if(this.range){if(logEnabled){var b=new Date().getTime()}var a=(this.stylingStrategy&&this.range.commonAncestorContainer.nodeType==Node.TEXT_NODE&&this.range.commonAncestorContainer.parentNode)?this.range.commonAncestorContainer.parentNode:this.range.commonAncestorContainer;while(typeof Clip.NON_ANCESTOR_NODES[a.nodeName]!="undefined"&&a.parentNode){if(a.nodeName=="BODY"){break}a=a.parentNode}this.content=this.serializeDOMNode(a);if(logEnabled){var c=new Date().getTime()}this.range=null;if(logEnabled){console.log("Success...");console.log("Clipped selection in "+(c-b)+" seconds")}return true}this.range=null;if(logEnabled){console.log("Failure")}return false};Clip.prototype.serializeDOMNode=function(j){var g="";if(this._includeFontFaceDescriptions&&this.stylingStrategy){var d=this.stylingStrategy.getFontFaceRules();if(d){g+="<style>\n";for(var h=0;h<d.length;h++){g+=d[h].cssText+"\n"}g+="</style>\n"}}var c=j;while(c){var o=(!this.range||this.range.intersectsNode(c))?true:false;if(o&&c.nodeType==Node.TEXT_NODE){if(this.range){if(this.range.startContainer==c&&this.range.startContainer==this.range.endContainer){g+=this.constructor.HTMLEncode(c.nodeValue.substring(this.range.startOffset,this.range.endOffset))}else{if(this.range.startContainer==c){g+=this.constructor.HTMLEncode(c.nodeValue.substring(this.range.startOffset))}else{if(this.range.endContainer==c){g+=this.constructor.HTMLEncode(c.nodeValue.substring(0,this.range.endOffset))}else{if(this.range.commonAncestorContainer!=c){g+=this.constructor.HTMLEncode(c.nodeValue)}}}}}else{g+=this.constructor.HTMLEncode(c.nodeValue)}}else{if(o&&c.nodeType==Node.ELEMENT_NODE&&typeof Clip.REJECT_NODES[c.nodeName]=="undefined"){var r=window.getComputedStyle(c);var f=r.getPropertyValue("display");var q=r.getPropertyValue("visibility");var p=r.getPropertyValue("position");if(f!="none"&&!(q=="hidden"&&p=="absolute")){var n=c.attributes;var b="";for(var e=0;e<n.length;e++){if(typeof Clip.NOKEEP_NODE_ATTRIBUTES[n[e].name]=="undefined"&&n[e].name.substring(0,2).toLowerCase()!="on"&&n[e].value&&!(n[e].name=="href"&&n[e].value.substring(0,11)=="javascript:")){var m=n[e].value.replace(/\"/g,'\\"');if((n[e].name=="src"||n[e].name=="href")&&m.toLowerCase().indexOf("http")!=0){var a=this.getDocumentBase();if(m.indexOf("/")==0){m=a.replace(/^(.*:\/\/[^\/]+).*$/,"$1")+m}else{m=(a.charAt(a.length-1)=="/")?a+m:a+"/"+m}}b+=" "+n[e].name+'="'+m+'"'}}if(this.stylingStrategy){var l=this.stylingStrategy.styleForNode(c,(c==j));if(l instanceof ClipStyle&&l.length>0){b+=' style="'+l.toString().replace(/\"/g,'\\"')+'"'}else{if(typeof l=="string"){b+=' style="'+l.replace(/\"/g,'\\"')+'"'}}}var k=Clip.NODE_NAME_TRANSLATIONS[c.nodeName]||c.nodeName;k=(typeof Clip.SUPPORTED_NODES[k]!="undefined")?k:Clip.NODE_NAME_TRANSLATIONS["*"];g+="<"+k+b;if(q!="hidden"&&c.hasChildNodes()){g+=">";c=c.childNodes[0];continue}else{if(typeof Clip.SELF_CLOSING_NODES[k]=="undefined"){g+="></"+k+">"}else{g+="/>"}}}}}if(c.nextSibling){c=c.nextSibling}else{if(c!=j){while(c.parentNode){c=c.parentNode;var k=Clip.NODE_NAME_TRANSLATIONS[c.nodeName]||c.nodeName;k=(typeof Clip.SUPPORTED_NODES[k]!="undefined")?k:Clip.NODE_NAME_TRANSLATIONS["*"];g+="</"+k+">";if(c==j){break}else{if(c.nextSibling){c=c.nextSibling;break}}}if(c==j){break}}else{break}}}return g};Clip.prototype.setStylingStrategy=function(a){if(typeof a=="function"&&a.inherits(ClipStylingStrategy)){this._stylingStrategy=new a(this.window)}else{if(a instanceof ClipStylingStrategy){this._stylingStrategy=a}else{if(a==null){this._stylingStrategy=null}}}};Clip.prototype.getStylingStrategy=function(){return this._stylingStrategy};Clip.prototype.toString=function(){return"Clip["+this.location+"] "+this.title};Clip.prototype.getLength=function(){var b=0;var c=this.toDataObject();for(var a in c){b+=(""+c[a]).length+a.length+2}b-=1;return b};Clip.prototype.toDataObject=function(){return{content:this.content,title:this.title,url:this.location.href,fullPage:this.fullPage}};function ClipStyle(a,b){this.__defineGetter__("styleFilter",this.getFilter);this.__defineSetter__("styleFilter",this.setFilter);this.initialize(a,b)}ClipStyle.stylePrefix=function(b){if(typeof b=="string"){var a=0;if((a=b.indexOf("-"))>0){return b.substring(0,a)}}return b};ClipStyle.findFontFaceRules=function(h){var j=h||document;var g=j.styleSheets;var a=[];for(var c=0;c<g.length;c++){var b=g[c];if(b.cssRules){for(var e=0;e<b.cssRules.length;e++){var f=b.cssRules[e];if(f instanceof CSSFontFaceRule){a.push(f)}}}}return a};ClipStyle.PERIMETERS=["top","right","bottom","left"];ClipStyle.PERIMETER_PROPS={margin:null,padding:null};ClipStyle.PERIMETER_EXTRA_PROPS={border:["width","style","color"],"border-top":["width","style","color"],"border-right":["width","style","color"],"border-bottom":["width","style","color"],"border-left":["width","style","color"],outline:["width","style","color"]};ClipStyle.prototype.length=0;ClipStyle.prototype._filter=null;ClipStyle.prototype.initialize=function(b,c){this.styleFilter=c;if(b instanceof CSSRuleList||b instanceof Array){if(b.length>0){for(var a=0;a<b.length;a++){this.addStyle(b[a].style)}}}else{if(b instanceof CSSStyleRule){this.addStyle(b.style)}else{if(b instanceof CSSStyleDeclaration){this.addStyle(b)}else{if(typeof b=="object"&&b!=null){this.addStyle(b)}}}}};ClipStyle.prototype._addPerimeterStyle=function(e,d){var b=d.replace(/\s+/," ").split(" ");if(b.length==1){b=b.concat(b,b,b)}else{if(b.length==2){b=b.concat(b[0],b[1])}else{if(b.length==3){b=b.concat(b[1])}else{if(b.length==0){b=["auto","auto","auto","auto"]}}}}for(var a=0;a<ClipStyle.PERIMETERS.length;a++){var c=e+"-"+ClipStyle.PERIMETERS[a];this._addSimpleStyle(c,b[a])}};ClipStyle.prototype._addPerimeterExtraStyle=function(a,c){var d=ClipStyle.PERIMETER_EXTRA_PROPS[a];if(d instanceof Array){var j=c.replace(/\s+/g," ").split(" ");var k=new RegExp(ClipStyle.PERIMETERS.join("|"),"i");var g=(a.match(k))?true:false;for(var f=0;f<ClipStyle.PERIMETERS.length;f++){for(var h=0;h<d.length;h++){var b=a+((g)?"":"-"+ClipStyle.PERIMETERS[f])+"-"+d[h];if(j[h]){this._addSimpleStyle(b,j[h])}}if(g){break}}}};ClipStyle.prototype._addSimpleStyle=function(b,a){if(typeof this[b]=="undefined"){this.length++}this[b]=a};ClipStyle.prototype.addStyle=function(b){if(b instanceof CSSStyleDeclaration&&b.length>0){for(var a=0;a<b.length;a++){var d=b[a];if(this.styleFilter&&!this.styleFilter(d,b.getPropertyValue(d))){continue}var c=b.getPropertyValue(d);if(typeof ClipStyle.PERIMETER_PROPS[d]!="undefined"){this._addPerimeterStyle(d,c)}else{if(typeof ClipStyle.PERIMETER_EXTRA_PROPS[d]!="undefined"){this._addPerimeterExtraStyle(d,c)}else{this._addSimpleStyle(d,c)}}}}else{if(b instanceof ClipStyle){for(var d in b){if(typeof this.constructor.prototype[d]=="undefined"){if(this.styleFilter&&!this.styleFilter(d,b[d])){continue}var c=b[d];if(typeof ClipStyle.PERIMETER_PROPS[d]!="undefined"){this._addPerimeterStyle(d,c)}else{if(typeof ClipStyle.PERIMETER_EXTRA_PROPS[d]!="undefined"){this._addPerimeterExtraStyle(d,c)}else{this._addSimpleStyle(d,c)}}}}}else{if(typeof b=="object"&&b!=null){for(var a in b){if(this.styleFilter&&!this.styleFilter(a,b[a])){continue}if(typeof b[a]!="function"&&typeof this.constructor.prototype[a]=="undefined"){var c=b[a];if(typeof ClipStyle.PERIMETER_PROPS[d]!="undefined"){this._addPerimeterStyle(d,c)}else{if(typeof ClipStyle.PERIMETER_EXTRA_PROPS[d]!="undefined"){this._addPerimeterExtraStyle(d,c)}else{this._addSimpleStyle(d,c)}}}}}}}};ClipStyle.prototype.removeStyle=function(d,c){var a=this;function f(h,g){if(typeof a[h]!="undefined"&&typeof a.constructor.prototype[h]=="undefined"&&(typeof c=="function"||a[h]==g)){if(typeof c!="function"||(typeof c=="function"&&c(h,a[h],g))){if(delete (a[h])){a.length--}}}}if(d instanceof CSSStyleDeclaration&&d.length>0){for(var b=0;b<d.length;b++){var e=d[b];f(e,d.getPropertyValue(e))}}else{if(d instanceof ClipStyle&&d.length>0){for(var e in d){f(e,d[e])}}else{if(d instanceof Array){for(var b=0;b<d.length;b++){f(d[b],this[d[b]])}}else{if(typeof d=="string"){f(d,this[d])}}}}};ClipStyle.prototype.removeStyleIgnoreValue=function(a){this.removeStyle(a,function(d,c,b){return true})};ClipStyle.styleInArray=function(c,b){if(typeof c!="string"||!(b instanceof Array)){return false}var a=-1;var c=c.toLowerCase();var d=((a=c.indexOf("-"))>0)?c.substring(0,a).toLowerCase():c.toLowerCase();for(var a=0;a<b.length;a++){if(b[a]==c||b[a]==d){return true}}return false};ClipStyle.prototype.deriveStyle=function(c,a,b){this.removeStyle(c,function(f,e,d){if(b instanceof Array&&ClipStyle.styleInArray(f,b)){return false}return(typeof a[f]=="undefined"&&e==d)})};ClipStyle.prototype.setFilter=function(a){if(typeof a=="function"){this._filter=a}else{if(a==null){this._filter=null}}};ClipStyle.prototype.getFilter=function(){return this._filter};ClipStyle.prototype.mergeStyle=function(d,b){if(d instanceof ClipStyle&&d.length>0){var c=true;for(var a in d){if(typeof this.constructor.prototype[a]!="undefined"||typeof this.__lookupSetter__(a)!="undefined"){continue}if((c=(typeof this[a]=="undefined"))||b){this[a]=d[a];if(c){this.length++}}}}};ClipStyle.prototype.clone=function(){var b=new ClipStyle();for(var a in this){if(typeof this.constructor.prototype[a]=="undefined"){b[a]=this[a]}}b.length=this.length;return b};ClipStyle.prototype.toString_background=function(a){var b="";if(typeof this["background-color"]!="undefined"&&this["background-color"]!="rgba(0, 0, 0, 0)"){b+="background: "+this["background-color"]}if(typeof this["background-image"]!="undefined"){if(this["background-image"]!="none"){b+=" "+this["background-image"];if(typeof this["background-position"]!="undefined"){b+=" "+this["background-position"]}if(typeof this["background-repeat"]!="undefined"){b+=" "+this["background-repeat"]}}}if(a){a["background-color"]=null;a["background-image"]=null;a["background-position"]=null;a["background-repeat"]=null}if(b.length==0){b+="background:none;"}else{if(b.length>0&&b.charAt(b.length-1)!=";"){b+=";"}}return b};ClipStyle.prototype.toString_outline=function(a){var b=this._toPerimeterExtraString("outline");if(a){a["outline-style"]=null;a["outline-width"]=null;a["outline-color"]=null}if(b.length>0&&b.charAt(b.length-1)!=";"){b+=";"}else{if(b.length==0){b="outline:none;"}}return b};ClipStyle.prototype.toString_margin=function(a){var b=this._toPerimeterString("margin");if(a){a["margin-top"]=null;a["margin-right"]=null;a["margin-bottom"]=null;a["margin-left"]=null}if(b.length>0&&b.charAt(b.length-1)!=";"){b+=";"}else{if(b.length==0){b="margin:none;"}}return b};ClipStyle.prototype.toString_padding=function(a){var b=this._toPerimeterString("padding");if(a){a["padding-top"]=null;a["padding-right"]=null;a["padding-bottom"]=null;a["padding-left"]=null}if(b.length>0&&b.charAt(b.length-1)!=";"){b+=";"}else{if(b.length==0){b="padding:none;"}}return b};ClipStyle.prototype.toString_border=function(a){var b=this._toPerimeterExtraString("border");if(a){a["border-top-width"]=null;a["border-top-style"]=null;a["border-top-color"]=null;a["border-right-width"]=null;a["border-right-style"]=null;a["border-right-color"]=null;a["border-bottom-width"]=null;a["border-bottom-style"]=null;a["border-bottom-color"]=null;a["border-left-width"]=null;a["border-left-style"]=null;a["border-left-color"]=null}if(b.length>0&&b.charAt(b.length-1)!=";"){b+=";"}if(b.length==0||b.indexOf("none")>=0){b="border:none;"}return b};ClipStyle.prototype.toString=function(c){var d="";var b={};if(c){d+=this.toString_background(b);d+=this.toString_border(b);d+=this.toString_margin(b);d+=this.toString_outline(b);d+=this.toString_padding(b)}if(this.length>0){for(var a in this){if(typeof this[a]!="string"||typeof this.constructor.prototype[a]!="undefined"||this[a].length==0||typeof b[a]!="undefined"){continue}d+=a+":"+this[a]+";"}}return d};ClipStyle.prototype._toPerimeterString=function(f){var c=[];var d=true;var b=false;var e="";for(var a=0;a<ClipStyle.PERIMETERS.length;a++){c[a]=this[f+"-"+ClipStyle.PERIMETERS[a]];if(c[a]){e+=f+"-"+ClipStyle.PERIMETERS[a]+":"+c[a]+";"}else{b=true}if(a>0&&d&&c[a]!=c[a-1]){d=false}}if(b){return e}else{if(d){c=[c[0]]}else{if(c[0]==c[2]&&c[1]==c[3]){c=[c[0],c[1]]}}}return f+":"+c.join(" ")+";"};ClipStyle.prototype._toPerimeterExtraString=function(b){var n=[];var m=true;var l="";for(var h=0;h<ClipStyle.PERIMETERS.length;h++){var j=b+"-"+ClipStyle.PERIMETERS[h];var f=ClipStyle.PERIMETER_EXTRA_PROPS[j]||ClipStyle.PERIMETER_EXTRA_PROPS[b];if(f instanceof Array){var c="";var a="";var g=false;for(var k=0;k<f.length;k++){var d=j+"-"+f[k];if(this[d]){c+=this[d]+((k==f.length-1)?"":" ");a+=d+":"+this[d]+";"}else{g=true;m=false}}if(!g){n[h]=c;l+=j+":"+c+";"}else{l+=a}}if(h>0&&m&&(!n[h]||n[h]!=n[h-1])){m=false}}if(m){return b+":"+n[0]+";"}else{return l}};ClipStyle.prototype.toJSON=function(){var b={};if(this.length>0){for(var a in this){if(typeof this[a]!="string"||typeof this.constructor.prototype[a]!="undefined"||this[a].length==0){continue}b[a]=this[a]}}return b};function SelectionFinder(a){this.initDocument=a;this.document=a}SelectionFinder.prototype.initDocument=null;SelectionFinder.prototype.document=null;SelectionFinder.prototype.selection=null;SelectionFinder.prototype.findNestedDocuments=function(f){var b=new Array();var g=f.getElementsByTagName("frame");if(g.length>0){for(var a=0;a<g.length;a++){b.push(g[a].contentDocument)}}var d=f.getElementsByTagName("iframe");try{if(d.length>0){for(var a=0;a<d.length;a++){var f=d[a].contentDocument;if(f){b.push(f)}}}}catch(c){}return b};SelectionFinder.prototype.reset=function(){this.document=this.initDocument;this.selection=null};SelectionFinder.prototype.hasSelection=function(){var a=this.getRange();if(a&&(a.startContainer!=a.endContainer||(a.startContainer==a.endContainer&&a.startOffset!=a.endOffset))){return true}return false};SelectionFinder.prototype.find=function(a){var b=this._findSelectionInDocument(this.document,a);this.document=b.document;this.selection=b.selection};SelectionFinder.prototype.getRange=function(){if(!this.selection||this.selection.rangeCount==0){return null}if(typeof this.selection.getRangeAt=="function"){return this.selection.getRangeAt(0)}else{var a=this.document.createRange();a.setStart(this.selection.anchorNode,this.selection.anchorOffset);a.setEnd(this.selection.focusNode,this.selection.focusOffset);return a}return null};SelectionFinder.prototype._findSelectionInDocument=function(e,b){var d=null;if(typeof e.getSelection=="function"){d=e.getSelection()}else{if(e.selection&&typeof e.selection.createRange=="function"){d=e.selection.createRange()}}if(d&&d.rangeCount==0&&b){if(logEnabled){console.log("Empty range, trying frames")}var f=this.findNestedDocuments(e);if(logEnabled){console.log("# of nested docs: "+f.length)}if(f.length>0){for(var c=0;c<f.length;c++){if(f[c]){if(logEnabled){console.log("Trying nested doc: "+f[c])}var a=this._findSelectionInDocument(f[c],b);if(a.selection.rangeCount>0){return a}}}}}return{document:e,selection:d}};function ClipStylingStrategy(a){this.initialize(a)}ClipStylingStrategy.DEFAULT_FILTER=function(b,a){return(a&&b!="orphans"&&b!="widows"&&b!="speak"&&b.indexOf("page-break")!=0&&b.indexOf("pointer-events")!=0)};ClipStylingStrategy.prototype.initialize=function(a){this.window=a};ClipStylingStrategy.prototype.styleForNode=function(b,a){return null};ClipStylingStrategy.prototype.getNodeStyle=function(g,f,e){var c=(typeof e=="function")?e:ClipStylingStrategy.DEFAULT_FILTER;if(g&&typeof g.nodeType=="number"&&g.nodeType==1){var h=g.ownerDocument;var a=(h.defaultView)?h.defaultView:this.window;var b=(typeof a.getMatchedCSSRules=="function")?true:false;if(f){return style=new ClipStyle(a.getComputedStyle(g,""),c)}else{if(b){return style=new ClipStyle(a.getMatchedCSSRules(g,""),c)}}}var d=new ClipStyle();d.setFilter(c);return d};ClipStylingStrategy.prototype.getFontFaceRules=function(){return ClipStyle.findFontFaceRules()};ClipStylingStrategy.prototype.cleanUp=function(){return true};function ClipTextStylingStrategy(a){this.initialize(a)}ClipTextStylingStrategy.inherit(ClipStylingStrategy);ClipTextStylingStrategy.FORMAT_NODE_NAMES={b:null,big:null,em:null,i:null,small:null,strong:null,sub:null,sup:null,ins:null,del:null,s:null,strike:null,u:null,code:null,kbd:null,samp:null,tt:null,"var":null,pre:null,listing:null,plaintext:null,xmp:null,abbr:null,acronym:null,address:null,bdo:null,blockquote:null,q:null,cite:null,dfn:null};ClipTextStylingStrategy.STYLE_ATTRS={font:null,text:null,color:null};ClipTextStylingStrategy.COLOR_THRESH=50;ClipTextStylingStrategy.prototype.isFormatNode=function(a){return(a&&a.nodeType==1&&typeof ClipTextStylingStrategy.FORMAT_NODE_NAMES[a.nodeName.toLowerCase()]!="undefined")};ClipTextStylingStrategy.prototype.hasTextNodes=function(b){if(b&&b.nodeType==1&&b.childNodes.length>0){for(var a=0;a<b.childNodes.length;a++){if(b.childNodes[a].nodeType==3){return true}}}return false};ClipTextStylingStrategy.prototype.styleFilter=function(b){var a=ClipStyle.stylePrefix(b.toLowerCase());if(typeof ClipTextStylingStrategy.STYLE_ATTRS[a]!="undefined"){return true}};ClipTextStylingStrategy.prototype.styleForNode=function(d,e){var l=null;if(this.isFormatNode(d)||this.hasTextNodes(d)){l=this.getNodeStyle(d,true,this.styleFilter)}if(l&&l.color){var f=l.color;var k="";var i=f.replace(/[^0-9,\s]+/g,"").replace(/[,\s]+/g," ").split(/\s+/);var c=parseInt(i[0]);c=(isNaN(c))?0:c;var h=parseInt(i[1]);h=(isNaN(h))?0:c;var j=parseInt(i[2]);j=(isNaN(j))?0:j;if((c+h+j)>(255-ClipTextStylingStrategy.COLOR_THRESH)*3){c=Math.max(0,c-ClipTextStylingStrategy.COLOR_THRESH);h=Math.max(0,h-ClipTextStylingStrategy.COLOR_THRESH);j=Math.max(0,j-ClipTextStylingStrategy.COLOR_THRESH)}l.color=(i.length==4)?"rgba("+[c,h,j,1].join(", ")+")":"rgb("+[c,h,j].join(", ")+")"}return l};function ClipFullStylingStrategy(a){this.initialize(a)}ClipFullStylingStrategy.inherit(ClipStylingStrategy);ClipFullStylingStrategy.SKIP_UNDEFINED_PROPS={widows:null,orphans:null,"pointer-events":null,speak:null};ClipFullStylingStrategy.SKIP_NONINHERENT_AUTO_PROPS={left:"auto",right:"auto","float":"auto",clear:"auto","image-rendering":"auto","z-index":"auto","color-rendering":"auto","shapre-rendering":"auto","page-break-before":"auto","page-break-after":"auto","page-break-inside":"auto"};ClipFullStylingStrategy.LIST_NODES={UL:null,OL:null,LI:null};ClipFullStylingStrategy.prototype.styleForNode=function(e,f){var a=this.getNodeStyle(e,false);var l=this.getNodeStyle(e,true,function(n,c){if(n&&(n.indexOf("-webkit-")==0||n.indexOf("-moz-")==0||typeof ClipFullStylingStrategy.SKIP_UNDEFINED_PROPS[n]!="undefined")){if(a.length==0||typeof a[n]=="undefined"){return false}else{return true}}else{if(n&&n.indexOf("list-style")==0){if(e&&e.nodeName&&typeof ClipFullStylingStrategy.LIST_NODES[e.nodeName]!="undefined"){return true}else{if(a.length==0||typeof a[n]=="undefined"){return false}else{return true}}}else{if(n&&typeof ClipFullStylingStrategy.SKIP_NONINHERENT_AUTO_PROPS[n]!="undefined"){if(c==ClipFullStylingStrategy.SKIP_NONINHERENT_AUTO_PROPS[n]&&(a.length==0||typeof a[n]=="undefined")){return false}else{return true}}}}return true});if(f&&typeof l.width!="undefined"){l._addSimpleStyle("min-width",l.width);var d=e.children;var b=false;var j=null;if(d&&d.length>0){for(var h=0;h<d.length;h++){var m=this.getNodeStyle(d[h],true);var i=d[h].getBoundingClientRect();if(!j){j=i}else{this._mergeBoundingRects(j,i)}if(m["float"]&&m["float"]!="none"&&m["float"]!="auto"){b=true}}}if(!b||!j){l.removeStyle("height")}else{l._addSimpleStyle("height",j.height)}l.removeStyle(["position","left","right","top","bottom","margin-left","margin-right","margin-top","margin-bottom"]);var g=this._inhBackgroundForNode(e,true);if(g["background-color"]){l["background-color"]=g["background-color"]}if(g["background-image"]){l["background-image"]=g["background-image"];var k=e.getBoundingClientRect();if(k){l["background-position-x"]=(0-k.left)+"px";l["background-position-y"]=(0-k.top)+"px";l["background-position"]=l["background-position-x"]+" "+l["background-position-y"]}if(g.opacity){l.opacity=g.opacity}if(g.filter){l.filter=g.filter}}}return l};ClipFullStylingStrategy.prototype._mergeBoundingRects=function(d,c){d.left=Math.min(d.left,c.left);d.right=Math.max(d.right,c.right);d.top=Math.min(d.top,c.top);d.bottom=Math.max(d.bottom,c.bottom);d.width=d.right-d.left;d.height=d.bottom-d.top};ClipFullStylingStrategy.prototype._inhBackgroundForNode=function(f,d){var c=f.parentNode;var e=[];while(c){e.push(this.getNodeStyle(c,true,function(i,h){if((i=="background-color"&&h!="rgba(0, 0, 0, 0)")||(i=="background-image"&&h!="none")||i=="opacity"||i=="filter"){return true}return false}));if(!d||c==this.window.document.body){break}c=c.parentNode}e.reverse();var g=new ClipStyle();for(var a=0;a<e.length;a++){var b=e[a];if(b["background-color"]){g._addSimpleStyle("background-color",b["background-color"])}if(b["background-image"]){g._addSimpleStyle("background-image",b["background-image"])}if(b.opacity&&!isNaN(parseFloat(b.opacity))&&(typeof g.opacity=="undefined"||parseFloat(b.opacity)<parseFloat(g.opacity))){g._addSimpleStyle("opacity",b.opacity)}if(b.filter&&(typeof g.filter=="undefined"||parseFloat(b.filter.replace(/[^0-9]+/g,""))<parseFloat(g.filter.replace(/[^0-9]+/g,"")))){g._addSimpleStyle("filter",b.filter)}if(g.length>0){break}}return g};ClipFullStylingStrategy.prototype.cleanUp=function(){if(this._dirty){var b=this.window.document.getElementsByTagName("*");for(var a=0;a<b.length;a++){delete b[a][this.constructor.COMPUTED_STYLE_KEY]}}return true};var clip=null;function notifyWithClip(c,a,b){if(c instanceof Clip){if(logEnabled){console.log("Total length: "+c.length)}var d=c.toDataObject();d[Evernote.Constants.REQUEST_TYPE]=a;if(typeof b=="string"){d[Evernote.Constants.REQUEST_MESSAGE]=b}if(logEnabled){console.log("Notifying extension with clip: "+JSON.stringify(d))}chrome.extension.sendRequest(d)}}function notify(c,a,b){if(typeof c!="object"||c==null){c={}}if(a){c[Evernote.Constants.REQUEST_TYPE]=a}if(b){c[Evernote.Constants.REQUEST_MESSAGE]=b}chrome.extension.sendRequest(c)}function main(a,b){if(logEnabled){console.log("Contentscript clipping...")}if(logEnabled){console.log("Cancelling timeout...")}notify(null,Evernote.Constants.RequestType.CANCEL_PAGE_CLIP_TIMER);clip=new Clip(window,b);if(logEnabled){console.log("CLIP: "+clip.toString())}try{if(clip.hasSelection()&&clip.clipSelection()){if(logEnabled){console.log("Successful clip of selection: "+clip.toString())}notifyWithClip(clip,Evernote.Constants.RequestType.PAGE_CLIP_SUCCESS)}else{if(clip.hasBody()){notifyWithClip(clip,Evernote.Constants.RequestType.PAGE_CLIP_SUCCESS);if(a){if(clip.clipBody()){if(clip.length>=(Evernote.Constants.Limits.CLIP_NOTE_CONTENT_LEN_MAX-1024)){if(logEnabled){console.log("Notifying full page clip failure")}notifyWithClip(clip,Evernote.Constants.RequestType.PAGE_CLIP_CONTENT_FAILURE,chrome.i18n.getMessage("fullPageClipTooBig"))}else{if(logEnabled){console.log("Notifying full page clip success")}notifyWithClip(clip,Evernote.Constants.RequestType.PAGE_CLIP_CONTENT_SUCCESS)}}else{notify(null,Evernote.Constants.RequestType.PAGE_CLIP_CONTENT_FAILURE,chrome.i18n.getMessage("fullPageClipFailure"))}}}else{if(logEnabled){console.log("Failed to clip full page")}notify(null,Evernote.Constants.RequestType.PAGE_CLIP_FAILURE,chrome.i18n.getMessage("fullPageClipFailure"))}}}catch(c){if(logEnabled){console.log("Exception clipping page or its selection"+((typeof c.message!="undefined")?": "+c.message:""))}notify(null,Evernote.Constants.RequestType.PAGE_CLIP_FAILURE,c.message)}if(logEnabled){console.log("Done clipping...")}};