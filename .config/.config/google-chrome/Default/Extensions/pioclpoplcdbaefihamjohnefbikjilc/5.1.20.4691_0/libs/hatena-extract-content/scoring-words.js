if(typeof ExtractContentJS=="undefined"){var ExtractContentJS={}}(function(b){var c=b.Lib.Util;var a=b.Lib.A;b.RelativeWords=function(){var d={engine:arguments[0]||[]};d.factory={getEngine:function(e){if(typeof b.RelativeWords.Engine!="undefined"){return new b.RelativeWords.Engine[e]}return null}};d.addEngine=function(e){if(typeof e!="undefined"){d.engine.push(e)}return d};d.top=function(g,i){var h={};for(var f in i){h[f]={score:0,df:i[f]}}a.forEach(d.engine,function(j){j.vote(g,h)});var e=[];for(var f in h){if(h[f].score){e.push({word:f,score:h[f].score})}}e.sort(function(k,j){return j.score-k.score});return e};return d};b.RelativeWords.Engine={};b.RelativeWords.Engine.TfIdf=function(){var e=arguments[0]||{limit:{text:32768}};var d={weight:e.weight||0.4};d.vote=function(r,l){var m=0;var n=0;var i={};var k=(r.content+"").substr(0,e.limit.text);k=k.toLowerCase();var p=(r.title||"").toLowerCase();var f=(r.url||"").toLowerCase();for(var s in l){m+=l[s].df}for(var s in l){var o=l[s].df;if(!o){continue}var j=Math.log(m/o);var g=0;var q=s.toLowerCase();g+=c.countMatchTokenized(k,q);g+=c.countMatchTokenized(p,q);i[s]=g/j;if(i[s]>n){n=i[s]}}if(!n){return}for(var s in i){var h=i[s]/n;l[s].score+=h*d.weight}};return d};b.RelativeWords.Engine.ContentPosition=function(){var e=arguments[0]||{limit:{text:32768}};var d={weight:e.weight||0.1};d.vote=function(l,j){var k=0;var g={};var i=(l.content+"").substr(0,e.limit.text);i=i.toLowerCase();for(var n in j){var m=n.toLowerCase();var h=c.indexOfTokenized(i,m);if(h>=0){g[n]=g[n]||0;g[n]+=1/(h+1);if(k<g[n]){k=g[n]}}}if(!k){return}for(var n in g){var f=g[n]/k;j[n].score+=f*d.weight}};return d};b.RelativeWords.Engine.TitlePosition=function(){var e=arguments[0]||{limit:{text:32768}};var d={weight:{global:(e.weight&&e.weight.global)||0.4,title:(e.weight&&e.weight.title)||0.35}};d.vote=function(l,i){var j=0;var g={};var k=(l.title||"").toLowerCase();for(var n in i){var m=n.toLowerCase();var h=c.indexOfTokenized(k,m);if(h>=0){g[n]=1+d.weight.title/(1+Math.log(h+1));if(j<g[n]){j=g[n]}}}if(!j){return}for(var n in g){var f=g[n]/j;i[n].score+=f*d.weight.global}};return d};b.suggestTags=function(f,h,d,e){var g=new b.RelativeWords();g.addEngine(g.factory.getEngine("TfIdf"));g.addEngine(g.factory.getEngine("ContentPosition"));g.addEngine(g.factory.getEngine("TitlePosition"));return g.top({url:f,title:h,content:d},e)};b.suggestTagsForDocument=function(h,e){if(!h.body){return null}var g=new b.LayeredExtractor();g.addHandler(g.factory.getHandler("Heuristics"));var f=g.extract(h);if(!f.isSuccess){return null}return b.suggestTags(f.url,f.title,f.content,e)}})(ExtractContentJS);